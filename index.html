<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limpieza Digital ‚Äì Marketplace Mundial</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --coral: #ff6b6b; --turquoise: #0d9488; --gray: #666; --dark: #000; }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, var(--turquoise), var(--coral)); color:white; padding-bottom:100px; min-height:100vh; }
        
        /* NAVEGACI√ìN EXACTA A TU IMAGEN */
        .bottom-nav {
            position:fixed; bottom:0; left:0; right:0; height:90px; background:rgba(0,0,0,0.92); backdrop-filter:blur(30px);
            display:flex; align-items:center; justify-content:center; z-index:9999; padding-bottom:env(safe-area-inset-bottom,20px);
        }
        .nav-container {
            background:rgba(255,255,255,0.08); backdrop-filter:blur(20px); border-radius:50px; padding:14px 34px;
            display:flex; gap:44px; box-shadow:0 8px 32px rgba(0,0,0,0.5);
        }
        .nav-item { display:flex; flex-direction:column; align-items:center; gap:6px; color:#888; font-size:11px; font-weight:600; transition:all 0.3s; cursor:pointer; }
        .nav-item i { font-size:25px; }
        .nav-item.active, .nav-item.active i { color:var(--coral); }
        .nav-item.active i { transform:scale(1.2); }

        .container { max-width:1400px; margin:0 auto; padding:20px; }
        header { text-align:center; padding:100px 20px 60px; }
        .logo { font-size:clamp(3rem,10vw,6rem); font-weight:900; background:linear-gradient(45deg,#fff,#ff8fa3); -webkit-background-clip:text; color:transparent; }

        .glass { background:rgba(255,255,255,0.12); backdrop-filter:blur(20px); border-radius:32px; padding:40px; margin:40px 0; border:1px solid rgba(255,255,255,0.2); }

        /* FORMULARIO COMPLETO */
        #add-form { display:grid; gap:16px; max-width:600px; margin:0 auto 60px; }
        input, textarea, button { padding:16px; border-radius:16px; border:none; font-size:16px; }
        input, textarea { background:rgba(255,255,255,0.2); color:white; }
        button { background:var(--coral); color:white; font-weight:bold; cursor:pointer; }

        /* TARJETAS DE SERVICIO */
        .services-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(340px,1fr)); gap:28px; }
        .service-card {
            background:rgba(255,255,255,0.15); border-radius:28px; overflow:hidden; transition:0.4s;
        }
        .service-card:hover { transform:translateY(-12px); box-shadow:0 25px 50px rgba(0,0,0,0.5); }
        .profile-pic { width:80px; height:80px; border-radius:50%; object-fit:cover; border:4px solid var(--coral); }
        .photos { display:flex; gap:8px; margin:12px 0; flex-wrap:wrap; }
        .photos img { width:100px; height:100px; border-radius:12px; object-fit:cover; }
        .distance { color:#0f0; font-weight:bold; }
        .private-info { filter:blur(6px); transition:0.3s; }
        .private-info:hover { filter:none; }
        .show-contact { background:#333; color:white; padding:10px; border-radius:50px; font-size:0.9rem; margin-top:8px; }
    </style>
</head>
<body>

    <!-- NAVEGACI√ìN PERFECTA -->
    <nav class="bottom-nav">
        <div class="nav-container">
            <div class="nav-item active" data-section="home"><i class="fas fa-home"></i><span>Home</span></div>
            <div class="nav-item" data-section="near"><i class="fas fa-location-arrow"></i><span>Cerca</span></div>
            <div class="nav-item" data-section="add"><i class="fas fa-plus-circle"></i><span>Ofrecer</span></div>
            <div class="nav-item" data-section="jobs"><i class="fas fa-comment-dots"></i><span>Jobs</span></div>
            <div class="nav-item" data-section="profile"><i class="fas fa-user"></i><span>Perfil</span></div>
        </div>
    </nav>

    <div class="container">
        <header>
            <h1 class="logo">Limpieza Digital</h1>
            <p style="font-size:1.6rem;">Marketplace mundial de limpieza ‚Äì Cerca de ti, en cualquier pa√≠s</p>
        </header>

        <!-- HOME: TODOS LOS SERVICIOS ORDENADOS POR DISTANCIA -->
        <section id="home" class="glass">
            <h2 style="text-align:center; margin-bottom:30px;">Cleaners m√°s cercanos</h2>
            <div class="services-grid" id="services-container"></div>
        </section>

        <!-- OFRECER SERVICIO -->
        <section id="add" class="glass">
            <h2 style="text-align:center; margin-bottom:30px;">Publica tu servicio (Mundial)</h2>
            <form id="add-form">
                <input type="text" placeholder="Tu nombre completo" required>
                <input type="text" placeholder="Ciudad y Pa√≠s (ej: Bogot√°, Colombia)" required>
                <input type="tel" placeholder="Tel√©fono con c√≥digo de pa√≠s (+57...)" required>
                <input type="email" placeholder="Email o Gmail" required>
                <input type="text" placeholder="Precio (ej: $20/hora o $500 fijo)" required>
                <textarea placeholder="Describe tus servicios (limpieza profunda, oficinas, etc.)" rows="3" required></textarea>
                <input type="url" placeholder="Foto de perfil (URL)" required>
                <input type="text" placeholder="Fotos de tu trabajo (URLs separadas por coma)" >
                <button type="submit">Publicar mi servicio global</button>
            </form>
        </section>
    </div>

    <script>
        const container = document.getElementById('services-container');
        const form = document.getElementById('add-form');
        let userLocation = null;

        // Obtener ubicaci√≥n del usuario
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                userLocation = { lat: pos.coords.latitude, lng: pos.coords.longitude };
                loadServices();
            }, () => loadServices());
        }

        // Distancia entre dos puntos (km)
        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2)**2 + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2)**2;
            return (R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a))).toFixed(1);
        }

        // Cargar servicios
        function loadServices() {
            const services = JSON.parse(localStorage.getItem('limpiezaGlobal') || '[]');
            container.innerHTML = '';
            services
                .map(s => {
                    if (userLocation && s.lat && s.lng) {
                        s.distance = getDistance(userLocation.lat, userLocation.lng, s.lat, s.lng);
                    }
                    return s;
                })
                .sort((a,b) => (a.distance || 9999) - (b.distance || 9999))
                .forEach(addCard);
        }

        function addCard(s) {
            const card = document.createElement('div');
            card.className = 'service-card';
            const photos = s.photos ? s.photos.split(',').slice(0,3).map(p => `<img src="${p.trim()}">`).join('') : '';
            const distance = s.distance ? `<span class="distance">A ${s.distance} km de ti</span>` : '';
            
            card.innerHTML = `
                <div style="padding:20px; text-align:center;">
                    <img class="profile-pic" src="${s.profile}" alt="${s.name}">
                    <h3 style="margin:12px 0;">${s.name}</h3>
                    <p><i class="fas fa-map-marker-alt"></i> ${s.city}</p>
                    ${distance}
                    <p style="margin:16px 0; opacity:0.9;">${s.desc}</p>
                    <div class="photos">${photos}</div>
                    <div style="margin:16px 0;">
                        <div class="private-info">üì± ${s.phone}</div>
                        <div class="private-info">‚úâÔ∏è ${s.email}</div>
                    </div>
                    <button class="show-contact" onclick="this.previousElementSibling.style.filter='none'">
                        Mostrar contacto
                    </button>
                    <div style="margin-top:12px; font-size:1.6rem; color:var(--coral); font-weight:bold;">
                        ${s.price}
                    </div>
                </div>
            `;
            container.appendChild(card);
        }

        // Guardar nuevo servicio + geolocalizaci√≥n
        form.addEventListener('submit', e => {
            e.preventDefault();
            const fd = new FormData(e.target);
            const city = fd.get('city') || e.target[1].value;
            
            // Geocodificar ciudad (simulado con API gratuita)
            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)}`)
                .then(r => r.json())
                .then(data => {
                    const loc = data[0] || {};
                    const service = {
                        name: e.target[0].value,
                        city: city,
                        phone: e.target[2].value,
                        email: e.target[3].value,
                        price: e.target[4].value,
                        desc: e.target[5].value,
                        profile: e.target[6].value,
                        photos: e.target[7].value,
                        lat: loc.lat ? parseFloat(loc.lat) : null,
                        lng: loc.lon ? parseFloat(loc.lon) : null,
                        date: new Date().toLocaleString()
                    };

                    const list = JSON.parse(localStorage.getItem('limpiezaGlobal') || '[]');
                    list.unshift(service);
                    localStorage.setItem('limpiezaGlobal', JSON.stringify(list));
                    loadServices();
                    form.reset();
                    alert('¬°Publicado en todo el mundo!');
                    document.querySelector('[data-section="home"]').click();
                });
        });

        // Navegaci√≥n
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                document.getElementById(this.dataset.section)?.scrollIntoView({ behavior: 'smooth' });
            });
        });

        // Carga inicial
        loadServices();
    </script>
</body>
</html>
